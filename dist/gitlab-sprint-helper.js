// ==UserScript==
// @name         GitLab Sprint Helper
// @namespace    http://tampermonkey.net/
// @version      1.2
// @description  Display a summary of assignees' time estimates on GitLab boards with API integration and comment shortcuts
// @author       You
// @match        https://gitlab.com/*/boards/*
// @grant        GM_setValue
// @grant        GM_getValue
// @run-at       document-idle
// @updateURL    https://gitlab.com/daniel_linkster/gitlab-helper/-/raw/main/dist/gitlab-sprint-helper.js
// @downloadURL  https://gitlab.com/daniel_linkster/gitlab-helper/-/raw/main/dist/gitlab-sprint-helper.js
// ==/UserScript==

!function(e){function getHistoryKey(){return`timeEstimateHistory_${function getCurrentUrlKey(){return e.location.href.split("#")[0]}()}`}function renderHistory(){const t=document.getElementById("history-time-summary-content");if(!t)return;t.innerHTML="";const s=getHistoryKey(),n=GM_getValue(s,[]),o=document.createElement("div");o.style.fontSize="12px",o.style.color="#666",o.style.marginBottom="10px",o.style.wordBreak="break-all";let l=e.location.href;if(l.length>60&&(l=l.substring(0,57)+"..."),t.appendChild(o),0===n.length){const e=document.createElement("p");return e.textContent="No history data available for this URL yet.",e.style.color="#666",void t.appendChild(e)}const i=document.createElement("button");i.textContent="Clear History",i.style.padding="3px 6px",i.style.fontSize="12px",i.style.backgroundColor="#dc3545",i.style.color="white",i.style.border="none",i.style.borderRadius="3px",i.style.cursor="pointer",i.style.marginBottom="10px",i.onclick=function(){confirm("Are you sure you want to clear history data for this URL?")&&(GM_setValue(s,[]),renderHistory())},t.appendChild(i);const a=document.createElement("table");a.style.width="100%",a.style.borderCollapse="collapse";const r=document.createElement("tr");r.style.borderBottom="2px solid #ddd",r.style.fontWeight="bold";const d=document.createElement("th");d.textContent="Date",d.style.textAlign="left",d.style.padding="5px 0";const c=document.createElement("th");c.textContent="Hours",c.style.textAlign="right",c.style.padding="5px 0";const u=document.createElement("th");u.textContent="Milestone",u.style.textAlign="left",u.style.padding="5px 0",r.appendChild(d),r.appendChild(c),r.appendChild(u),a.appendChild(r),n.slice().reverse().forEach((e=>{const t=document.createElement("tr");t.style.borderBottom="1px solid #eee";const s=document.createElement("td"),n=new Date(e.timestamp);s.textContent=n.toLocaleDateString()+" "+n.toLocaleTimeString().substring(0,5),s.style.padding="5px 0";const o=document.createElement("td");o.textContent=`${e.totalHours}h`,o.style.textAlign="right",o.style.padding="5px 0";const l=document.createElement("td");l.textContent=e.milestone,l.style.padding="5px 0",t.appendChild(s),t.appendChild(o),t.appendChild(l),a.appendChild(t)})),t.appendChild(a)}e.gitlabApi=e.gitlabApi||new class GitLabAPI{constructor(){this.csrfToken=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),this.baseUrl="/api/v4"}callGitLabApi(e,t={}){const{method:s="GET",data:n=null,params:o=null}=t;let l=`${this.baseUrl}/${e}`;if(o){const e=new URLSearchParams;Object.entries(o).forEach((([t,s])=>{null!=s&&e.append(t,s)}));const t=e.toString();t&&(l+=`?${t}`)}const i={method:s,headers:{"Content-Type":"application/json"},credentials:"same-origin"};return"GET"!==s&&this.csrfToken&&(i.headers["X-CSRF-Token"]=this.csrfToken),n&&["POST","PUT","PATCH"].includes(s)&&(i.body=JSON.stringify(n)),fetch(l,i).then((e=>{if(!e.ok)throw new Error(`API request failed: ${e.status} ${e.statusText}`);return e.json()}))}getIssue(e){const t=e.referencePath.split("#")[0],s=e.iid,n=encodeURIComponent(t);return this.callGitLabApi(`projects/${n}/issues/${s}`)}addComment(e,t){const s=e.referencePath.split("#")[0],n=e.iid,o=encodeURIComponent(s);return this.callGitLabApi(`projects/${o}/issues/${n}/notes`,{method:"POST",data:{body:t}})}getCurrentUser(){return this.callGitLabApi("user")}getProject(e){return this.callGitLabApi(`projects/${e}`)}getProjectIssues(e,t={}){return this.callGitLabApi(`projects/${e}/issues`,{params:t})}getMilestone(e,t){return this.callGitLabApi(`projects/${e}/milestones/${t}`)}updateIssue(e,t){const s=e.referencePath.split("#")[0],n=e.iid,o=encodeURIComponent(s);return this.callGitLabApi(`projects/${o}/issues/${n}`,{method:"PUT",data:t})}getIssueItemFromCard(e){try{if(e.__vue__&&e.__vue__.$children){const t=e.__vue__.$children.find((e=>e.$props&&e.$props.item));if(t&&t.$props&&t.$props.item)return t.$props.item}}catch(e){console.error("Error getting issue item from card:",e)}return null}};class TabManager{constructor(uiManager){this.uiManager=uiManager,this.tabContainer=null,this.tabs={},this.contentAreas={},this.currentTab="summary"}initialize(e){this.tabContainer=document.createElement("div"),this.tabContainer.style.display="flex",this.tabContainer.style.marginBottom="10px",this.tabContainer.style.borderBottom="1px solid #ddd",this.createTab("summary","Summary",!0),this.createTab("boards","Boards"),this.createTab("history","History"),this.createTab("api","API"),e.appendChild(this.tabContainer),this.createContentAreas(e)}createTab(e,t,s=!1){const n=document.createElement("div");n.textContent=t,n.dataset.tab=e,n.style.padding="5px 10px",n.style.cursor="pointer",s&&(n.style.borderBottom="2px solid #1f75cb",n.style.fontWeight="bold",this.currentTab=e),n.addEventListener("click",(()=>{this.switchToTab(e)})),this.tabs[e]=n,this.tabContainer.appendChild(n)}createContentAreas(e){const t=document.createElement("div");t.id="assignee-time-summary-content",t.style.display="summary"===this.currentTab?"block":"none",e.appendChild(t),this.contentAreas.summary=t;const s=document.createElement("div");s.id="boards-time-summary-content",s.style.display="boards"===this.currentTab?"block":"none",e.appendChild(s),this.contentAreas.boards=s;const n=document.createElement("div");n.id="history-time-summary-content",n.style.display="history"===this.currentTab?"block":"none",e.appendChild(n),this.contentAreas.history=n;const o=document.createElement("div");o.id="api-info-content",o.style.display="api"===this.currentTab?"block":"none",e.appendChild(o),this.contentAreas.api=o}switchToTab(e){Object.keys(this.tabs).forEach((e=>{this.tabs[e].style.borderBottom="none",this.tabs[e].style.fontWeight="normal",this.contentAreas[e].style.display="none"})),this.tabs[e].style.borderBottom="2px solid #1f75cb",this.tabs[e].style.fontWeight="bold",this.contentAreas[e].style.display="block",this.currentTab=e,"history"===e?renderHistory():"api"===e&&this.uiManager.apiView.render()}getContentArea(e){return this.contentAreas[e]}getCurrentTab(){return this.currentTab}}class SummaryTabView{constructor(uiManager){this.uiManager=uiManager}render(e,t,s,n,o){const l=document.getElementById("assignee-time-summary-content");if(!l)return;if(l.innerHTML="",this.uiManager.updateStatus(`Processed ${s} tickets`),0===n)return void this.renderNoDataMessage(l);const i=(t/3600).toFixed(1);this.uiManager.updateHeader(`Summary ${i}h`),o&&this.renderMilestoneInfo(l,o),this.renderDataTable(l,e,i)}renderNoDataMessage(e){const t=document.createElement("p");t.textContent="No time estimate data found. Make sure the board is fully loaded and try again.",t.style.color="#666",e.appendChild(t);const s=document.createElement("p");s.style.fontSize="12px",s.style.fontStyle="italic",s.innerHTML="Tip: Try scrolling through all cards to ensure they are loaded before clicking Recalculate.",e.appendChild(s),this.uiManager.updateHeader("Summary 0.0h")}renderMilestoneInfo(e,t){const s=document.createElement("div");s.style.marginBottom="10px",s.style.fontSize="13px",s.style.color="#555",s.textContent=`Current Milestone: ${t}`,e.appendChild(s)}renderDataTable(e,t,s){const n=document.createElement("table");n.style.width="100%",n.style.borderCollapse="collapse";const o=document.createElement("tr");o.style.borderBottom="2px solid #ddd",o.style.fontWeight="bold";const l=document.createElement("td");l.textContent="Total",l.style.padding="5px 0";const i=document.createElement("td");i.textContent=`${s}h`,i.style.textAlign="right",i.style.padding="5px 0",o.appendChild(l),o.appendChild(i),n.appendChild(o);Object.keys(t).sort(((e,s)=>t[s]-t[e])).forEach((e=>{const s=(t[e]/3600).toFixed(1),o=document.createElement("tr");o.style.borderBottom="1px solid #eee";const l=document.createElement("td");l.textContent=e,l.style.padding="5px 0";const i=document.createElement("td");i.textContent=`${s}h`,i.style.textAlign="right",i.style.padding="5px 0",o.appendChild(l),o.appendChild(i),n.appendChild(o)})),e.appendChild(n)}}class BoardsTabView{constructor(uiManager){this.uiManager=uiManager}render(e,t){const s=document.getElementById("boards-time-summary-content");if(!s)return;s.innerHTML="";const n=document.createElement("div");n.className="boards-list-summary";Object.keys(e).sort(((t,s)=>e[s].timeEstimate-e[t].timeEstimate)).forEach((s=>{const o=this.createBoardSection(s,e[s],t[s]);n.appendChild(o)})),s.appendChild(n)}createBoardSection(e,t,s){const n=(t.timeEstimate/3600).toFixed(1),o=document.createElement("div");o.className="board-section",o.style.marginBottom="15px";const l=document.createElement("div");l.className="board-header",l.style.display="flex",l.style.justifyContent="space-between",l.style.padding="5px",l.style.backgroundColor="#f5f5f5",l.style.borderRadius="3px",l.style.cursor="pointer",l.style.fontWeight="bold";const i=document.createElement("div");i.className="board-details",i.style.display="none",i.style.marginTop="5px",i.style.marginLeft="10px",l.addEventListener("click",(()=>{"none"===i.style.display?(i.style.display="block",r.textContent="â–¼"):(i.style.display="none",r.textContent="â–¶")}));const a=document.createElement("div");a.textContent=`${e} (${t.tickets} tickets, ${n}h)`;const r=document.createElement("span");return r.textContent="â–¶",r.style.marginLeft="5px",l.appendChild(a),l.appendChild(r),s&&i.appendChild(this.createAssigneeTable(s)),o.appendChild(l),o.appendChild(i),o}createAssigneeTable(e){const t=document.createElement("table");t.style.width="100%",t.style.borderCollapse="collapse",t.style.marginTop="5px";const s=document.createElement("tr");s.style.borderBottom="1px solid #ddd";const n=document.createElement("th");n.textContent="Assignee",n.style.textAlign="left",n.style.padding="3px 0";const o=document.createElement("th");o.textContent="Tickets",o.style.textAlign="right",o.style.padding="3px 5px";const l=document.createElement("th");l.textContent="Hours",l.style.textAlign="right",l.style.padding="3px 0",s.appendChild(n),s.appendChild(o),s.appendChild(l),t.appendChild(s);return Object.keys(e).sort(((t,s)=>e[s].timeEstimate-e[t].timeEstimate)).forEach((s=>{const n=e[s],o=(n.timeEstimate/3600).toFixed(1),l=document.createElement("tr");l.style.borderBottom="1px solid #eee";const i=document.createElement("td");i.textContent=s,i.style.padding="3px 0";const a=document.createElement("td");a.textContent=n.tickets,a.style.textAlign="right",a.style.padding="3px 5px";const r=document.createElement("td");r.textContent=`${o}h`,r.style.textAlign="right",r.style.padding="3px 0",l.appendChild(i),l.appendChild(a),l.appendChild(r),t.appendChild(l)})),t}}class HistoryTabView{constructor(uiManager){this.uiManager=uiManager}render(){const t=document.getElementById("history-time-summary-content");if(!t)return;t.innerHTML="";const s=getHistoryKey(),n=GM_getValue(s,[]),o=document.createElement("div");o.style.fontSize="12px",o.style.color="#666",o.style.marginBottom="10px",o.style.wordBreak="break-all";let l=e.location.href;l.length>60&&(l=l.substring(0,57)+"..."),t.appendChild(o),0!==n.length?(this.addClearHistoryButton(t,s),this.renderHistoryTable(t,n)):this.renderNoHistoryMessage(t)}renderNoHistoryMessage(e){const t=document.createElement("p");t.textContent="No history data available for this URL yet.",t.style.color="#666",e.appendChild(t)}addClearHistoryButton(e,t){const s=document.createElement("button");s.textContent="Clear History",s.style.padding="3px 6px",s.style.fontSize="12px",s.style.backgroundColor="#dc3545",s.style.color="white",s.style.border="none",s.style.borderRadius="3px",s.style.cursor="pointer",s.style.marginBottom="10px",s.onclick=()=>{confirm("Are you sure you want to clear history data for this URL?")&&(GM_setValue(t,[]),this.render())},e.appendChild(s)}renderHistoryTable(e,t){const s=document.createElement("table");s.style.width="100%",s.style.borderCollapse="collapse";const n=document.createElement("tr");n.style.borderBottom="2px solid #ddd",n.style.fontWeight="bold";const o=document.createElement("th");o.textContent="Date",o.style.textAlign="left",o.style.padding="5px 0";const l=document.createElement("th");l.textContent="Hours",l.style.textAlign="right",l.style.padding="5px 0";const i=document.createElement("th");i.textContent="Milestone",i.style.textAlign="left",i.style.padding="5px 0",n.appendChild(o),n.appendChild(l),n.appendChild(i),s.appendChild(n),t.slice().reverse().forEach((e=>{const t=document.createElement("tr");t.style.borderBottom="1px solid #eee";const n=document.createElement("td"),o=new Date(e.timestamp);n.textContent=o.toLocaleDateString()+" "+o.toLocaleTimeString().substring(0,5),n.style.padding="5px 0";const l=document.createElement("td");l.textContent=`${e.totalHours}h`,l.style.textAlign="right",l.style.padding="5px 0";const i=document.createElement("td");i.textContent=e.milestone,i.style.padding="5px 0",t.appendChild(n),t.appendChild(l),t.appendChild(i),s.appendChild(t)})),e.appendChild(s)}}class CommentShortcuts{constructor(e){this.targetElement=e.targetElement,this.onShortcutInsert=e.onShortcutInsert||null,this.shortcutsContainer=null,this.shortcuts=[]}initialize(e){this.shortcutsContainer=document.createElement("div"),this.shortcutsContainer.className="comment-shortcuts-container",this.shortcutsContainer.style.marginBottom="10px",this.shortcutsContainer.style.display="flex",this.shortcutsContainer.style.flexWrap="wrap",this.shortcutsContainer.style.gap="8px",e.insertBefore(this.shortcutsContainer,this.targetElement),this.initializeEstimateShortcut()}initializeEstimateShortcut(){const e=document.createElement("div");e.className="shortcut-item estimate-shortcut",e.style.display="flex",e.style.alignItems="center";const t=document.createElement("span");t.textContent="/estimate",t.style.fontSize="13px",t.style.marginRight="5px",t.style.fontFamily="monospace",t.style.color="#555",e.appendChild(t);const s=document.createElement("select");s.className="estimate-dropdown",s.style.padding="3px 6px",s.style.borderRadius="3px",s.style.border="1px solid #ccc",s.style.backgroundColor="#f8f9fa",s.style.fontSize="12px";[{value:"",label:"Estimate Hours"},{value:"1",label:"1h"},{value:"2",label:"2h"},{value:"4",label:"4h"},{value:"8",label:"8h"},{value:"16",label:"16h"},{value:"32",label:"32h"},{value:"custom",label:"Custom..."}].forEach((e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,s.appendChild(t)})),s.addEventListener("change",(()=>{const e=s.value;e&&("custom"===e?this.handleCustomEstimate():this.insertEstimateText(e),s.value="")})),e.appendChild(s),this.shortcutsContainer.appendChild(e),this.shortcuts.push({type:"estimate",element:e})}handleCustomEstimate(){const e=prompt("Enter custom estimate hours (whole numbers only):","");if(null===e||""===e)return;const t=parseInt(e,10);isNaN(t)||t<=0||t!==parseFloat(e)?alert("Please enter a valid positive whole number."):this.insertEstimateText(t.toString())}insertEstimateText(e){if(!this.targetElement)return;const t=`/estimate ${e}h`,s=this.targetElement.selectionStart,n=this.targetElement.selectionEnd,o=this.targetElement.value;let l=t;s>0&&"\n"!==o.charAt(s-1)&&o.length>0&&(l="\n"+l);const i=o.substring(0,s)+l+o.substring(n);this.targetElement.value=i,this.targetElement.focus();const a=s+l.length;this.targetElement.setSelectionRange(a,a),"function"==typeof this.onShortcutInsert&&this.onShortcutInsert("estimate",e)}addCustomShortcut(e){const t=document.createElement("div");t.className=`shortcut-item ${e.type}-shortcut`,t.style.display="flex",t.style.alignItems="center";const s=document.createElement("span");s.textContent=e.label,s.style.fontSize="13px",s.style.marginRight="5px",s.style.fontFamily="monospace",s.style.color="#555",t.appendChild(s);const n=document.createElement("select");n.className=`${e.type}-dropdown`,n.style.padding="3px 6px",n.style.borderRadius="3px",n.style.border="1px solid #ccc",n.style.backgroundColor="#f8f9fa",n.style.fontSize="12px",e.items.forEach((e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,n.appendChild(t)})),n.addEventListener("change",(()=>{const t=n.value;t&&"function"==typeof e.onSelect&&e.onSelect(t),n.value=""})),t.appendChild(n),this.shortcutsContainer.appendChild(t),this.shortcuts.push({type:e.type,element:t})}}class IssueSelector{constructor(uiManager){this.uiManager=uiManager,this.isSelectingIssue=!1,this.selectionOverlays=[],this.selectedOverlays=[],this.selectedIssues=[],document.addEventListener("keydown",(e=>{"Escape"===e.key&&this.isSelectingIssue&&this.exitSelectionMode()}))}startSelection(){this.isSelectingIssue=!0,this.selectedIssues=[];const e=document.getElementById("comment-status");e&&(e.textContent="Click on cards to select issues. Press ESC to cancel or DONE to confirm.",e.style.color="#1f75cb");const t=document.createElement("div");t.id="selection-page-overlay",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 0, 0, 0.2)",t.style.zIndex="998",t.style.pointerEvents="none",document.body.appendChild(t),this.createCardOverlays(),this.createDoneButton()}createDoneButton(){const e=document.createElement("div");e.id="selection-done-button",e.textContent="DONE",e.style.position="fixed",e.style.bottom="20px",e.style.right="330px",e.style.backgroundColor="#28a745",e.style.color="white",e.style.padding="10px 20px",e.style.borderRadius="4px",e.style.cursor="pointer",e.style.fontWeight="bold",e.style.zIndex="999",e.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.2)",e.style.transition="all 0.2s ease",e.addEventListener("mouseenter",(()=>{e.style.backgroundColor="#218838",e.style.transform="translateY(-2px)",e.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"})),e.addEventListener("mouseleave",(()=>{e.style.backgroundColor="#28a745",e.style.transform="translateY(0)",e.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.2)"})),e.addEventListener("click",(()=>{if(this.selectedIssues.length>0)this.confirmSelection();else{const e=document.getElementById("comment-status");e&&(e.textContent="No issues selected. Please select at least one issue.",e.style.color="#dc3545")}})),document.body.appendChild(e),this.selectionOverlays.push(e);const t=document.createElement("div");t.id="selection-counter",t.textContent="0 issues selected",t.style.position="fixed",t.style.bottom="20px",t.style.left="20px",t.style.backgroundColor="rgba(0, 0, 0, 0.7)",t.style.color="white",t.style.padding="8px 16px",t.style.borderRadius="20px",t.style.fontSize="14px",t.style.zIndex="999",t.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.3)",document.body.appendChild(t),this.selectionOverlays.push(t)}updateSelectionCounter(){const e=document.getElementById("selection-counter");if(e){const t=this.selectedIssues.length;e.textContent=`${t} issue${1!==t?"s":""} selected`,e.style.backgroundColor=t>0?"rgba(40, 167, 69, 0.8)":"rgba(0, 0, 0, 0.7)"}}confirmSelection(){this.selectedIssues.length>0&&(this.uiManager.apiView.setSelectedIssues(this.selectedIssues),this.exitSelectionMode())}createCardOverlays(){document.querySelectorAll(".board-card").forEach((e=>{const t=e.getBoundingClientRect(),s=document.createElement("div");s.className="card-selection-overlay",s.style.position="absolute",s.style.left=`${t.left}px`,s.style.top=`${t.top}px`,s.style.width=`${t.width}px`,s.style.height=`${t.height}px`,s.style.backgroundColor="rgba(31, 117, 203, 0.2)",s.style.border="2px solid rgba(31, 117, 203, 0.6)",s.style.borderRadius="4px",s.style.zIndex="999",s.style.cursor="pointer",s.style.transition="background-color 0.2s ease",s.dataset.cardId=e.id||Date.now()+Math.random().toString(36).substring(2,9),s.dataset.selected="false",s.dataset.originalCard=e.id||e.innerText.substring(0,20),s.addEventListener("mouseenter",(()=>{"true"!==s.dataset.selected&&(s.style.backgroundColor="rgba(31, 117, 203, 0.3)",s.style.boxShadow="0 0 8px rgba(31, 117, 203, 0.5)")})),s.addEventListener("mouseleave",(()=>{"true"!==s.dataset.selected&&(s.style.backgroundColor="rgba(31, 117, 203, 0.2)",s.style.boxShadow="none")})),s.addEventListener("click",(t=>{t.stopPropagation(),this.toggleCardSelection(e,s)})),document.body.appendChild(s),this.selectionOverlays.push(s)}));const e=document.createElement("div");e.id="selection-help-text",e.textContent="Click on issues to select/deselect them â€¢ Press ESC to cancel",e.style.position="fixed",e.style.top="10px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.color="white",e.style.padding="8px 16px",e.style.borderRadius="20px",e.style.fontSize="14px",e.style.zIndex="999",e.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.3)",document.body.appendChild(e),this.selectionOverlays.push(e)}toggleCardSelection(e,t){if(!this.isSelectingIssue)return;const s=gitlabApi.getIssueItemFromCard(e);if(s){if("true"===t.dataset.selected)t.dataset.selected="false",t.style.backgroundColor="rgba(31, 117, 203, 0.2)",t.style.borderColor="rgba(31, 117, 203, 0.6)",t.style.boxShadow="none",this.selectedIssues=this.selectedIssues.filter((e=>!(e.iid===s.iid&&e.referencePath===s.referencePath))),this.selectedOverlays=this.selectedOverlays.filter((e=>e!==t));else{t.dataset.selected="true",t.style.backgroundColor="rgba(0, 177, 106, 0.3)",t.style.borderColor="rgba(0, 177, 106, 0.8)",t.style.boxShadow="0 0 12px rgba(0, 177, 106, 0.3)";const e=this.selectedIssues.length+1,n=document.createElement("div");n.className="selection-badge",n.textContent=e,n.style.position="absolute",n.style.top="-10px",n.style.right="-10px",n.style.width="20px",n.style.height="20px",n.style.borderRadius="50%",n.style.backgroundColor="rgba(0, 177, 106, 1)",n.style.color="white",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.fontWeight="bold",n.style.fontSize="12px",n.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.2)",t.querySelectorAll(".selection-badge").forEach((e=>e.remove())),t.appendChild(n),this.selectedIssues.push(s),this.selectedOverlays.push(t)}this.updateSelectionCounter()}else{t.style.backgroundColor="rgba(220, 53, 69, 0.4)",t.style.borderColor="rgba(220, 53, 69, 0.8)",setTimeout((()=>{t.style.backgroundColor="rgba(31, 117, 203, 0.2)",t.style.borderColor="rgba(31, 117, 203, 0.6)"}),500);const e=document.getElementById("comment-status");e&&(e.textContent="Could not extract issue data from this card. Try another one.",e.style.color="#dc3545")}}exitSelectionMode(){this.isSelectingIssue=!1,document.getElementById("selection-page-overlay")?.remove(),this.selectionOverlays.forEach((e=>{e.remove()})),this.selectionOverlays=[],this.selectedOverlays=[];const e=document.getElementById("comment-status");e&&(this.selectedIssues.length>0?(e.textContent=`${this.selectedIssues.length} issues selected. Enter your comment and click "Add Comment".`,e.style.color="green"):(e.textContent="Selection canceled. Try again.",e.style.color="#666"))}repositionOverlays(){if(!this.isSelectingIssue)return;document.querySelectorAll(".board-card").forEach((e=>{const t=this.selectionOverlays.find((t=>t.dataset&&"card-selection-overlay"===t.className&&t.dataset.originalCard===(e.id||e.innerText.substring(0,20))));if(t){const s=e.getBoundingClientRect();t.style.left=`${s.left}px`,t.style.top=`${s.top}px`,t.style.width=`${s.width}px`,t.style.height=`${s.height}px`}}));const e=document.getElementById("selection-done-button");e&&(e.style.bottom="20px",e.style.right="330px");const t=document.getElementById("selection-counter");t&&(t.style.bottom="20px",t.style.left="20px")}}class ApiTabView{constructor(uiManager){this.uiManager=uiManager,this.selectedIssues=[],this.commentShortcuts=null}render(){const e=document.getElementById("api-info-content");if(!e)return;e.innerHTML="";const t=document.createElement("h4");t.textContent="GitLab API Tools",t.style.margin="0 0 10px 0",e.appendChild(t);const s=document.createElement("div");s.id="api-loading",s.textContent="Loading user info...",s.style.fontSize="12px",s.style.color="#666",s.style.fontStyle="italic",e.appendChild(s),this.loadUserInfo(e)}loadUserInfo(e){gitlabApi.getCurrentUser().then((t=>{document.getElementById("api-loading")?.remove();const s=document.createElement("div");s.classList.add("api-section"),s.style.marginBottom="15px";const n=document.createElement("div");n.style.fontWeight="bold",n.style.marginBottom="5px",n.textContent="Current User:",s.appendChild(n);const o=document.createElement("div");o.textContent=`${t.name} (${t.username})`,s.appendChild(o),e.appendChild(s),this.addCommentSection(e)})).catch((t=>{const s=document.getElementById("api-loading");s&&(s.textContent=`Error: ${t.message}`,s.style.color="#dc3545"),console.error("Error fetching user info:",t),this.addCommentSection(e)}))}addCommentSection(e){const t=document.createElement("div");t.classList.add("api-section"),t.style.marginBottom="15px",t.style.padding="10px",t.style.backgroundColor="#f5f5f5",t.style.borderRadius="8px",t.style.border="1px solid #e0e0e0";const s=document.createElement("div");s.style.fontWeight="bold",s.style.marginBottom="10px",s.textContent="Add Comment to Selected Issues",t.appendChild(s);const n=document.createElement("div");n.style.marginBottom="12px",n.style.padding="8px",n.style.borderRadius="4px",n.style.border="1px dashed #ccc",n.style.backgroundColor="#f9f9f9",n.style.maxHeight="150px",n.style.overflowY="auto";const o=document.createElement("div");o.style.fontSize="12px",o.style.color="#666",o.style.marginBottom="5px",o.textContent="Selected Issues:",n.appendChild(o);const l=document.createElement("div");l.id="selected-issues-list",l.style.fontSize="14px";const i=document.createElement("div");i.id="no-issues-selected",i.textContent="No issues selected",i.style.color="#666",i.style.fontStyle="italic",l.appendChild(i),n.appendChild(l),t.appendChild(n);const a=document.createElement("textarea");a.id="issue-comment-input",a.placeholder="Enter your comment here...",a.style.width="100%",a.style.padding="8px",a.style.marginBottom="12px",a.style.borderRadius="4px",a.style.border="1px solid #ccc",a.style.minHeight="60px",a.style.fontSize="14px",a.style.transition="border-color 0.2s ease",a.style.resize="vertical",a.addEventListener("focus",(()=>{a.style.borderColor="#1f75cb",a.style.outline="none",a.style.boxShadow="0 0 0 2px rgba(31, 117, 203, 0.2)"})),a.addEventListener("blur",(()=>{a.style.borderColor="#ccc",a.style.boxShadow="none"})),this.commentShortcuts=new CommentShortcuts({targetElement:a,onShortcutInsert:(e,t)=>{console.log(`Shortcut inserted: ${e} with value ${t}`)}}),t.appendChild(a),this.commentShortcuts.initialize(t);const r=document.createElement("div");r.style.display="flex",r.style.gap="8px",r.style.marginBottom="8px";const d=document.createElement("button");d.textContent="ðŸ“Ž Select Issues",d.style.padding="8px 12px",d.style.backgroundColor="#6c757d",d.style.color="white",d.style.border="none",d.style.borderRadius="4px",d.style.cursor="pointer",d.style.fontSize="14px",d.style.transition="background-color 0.2s ease",d.style.display="flex",d.style.alignItems="center",d.style.justifyContent="center",d.addEventListener("mouseenter",(()=>{d.style.backgroundColor="#5a6268"})),d.addEventListener("mouseleave",(()=>{d.style.backgroundColor="#6c757d"})),d.onclick=()=>this.uiManager.issueSelector.startSelection(),r.appendChild(d);const c=document.createElement("button");c.textContent="ðŸ’¬ Add Comment",c.style.padding="8px 12px",c.style.backgroundColor="#1f75cb",c.style.color="white",c.style.border="none",c.style.borderRadius="4px",c.style.cursor="pointer",c.style.fontSize="14px",c.style.transition="background-color 0.2s ease",c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="center",c.style.flex="1",c.addEventListener("mouseenter",(()=>{c.style.backgroundColor="#1a63ac"})),c.addEventListener("mouseleave",(()=>{c.style.backgroundColor="#1f75cb"})),c.onclick=()=>this.submitComments(),r.appendChild(c);const u=document.createElement("button");u.textContent="ðŸ—‘ï¸ Clear",u.style.padding="8px 12px",u.style.backgroundColor="#dc3545",u.style.color="white",u.style.border="none",u.style.borderRadius="4px",u.style.cursor="pointer",u.style.fontSize="14px",u.style.transition="background-color 0.2s ease",u.style.display="flex",u.style.alignItems="center",u.style.justifyContent="center",u.addEventListener("mouseenter",(()=>{u.style.backgroundColor="#c82333"})),u.addEventListener("mouseleave",(()=>{u.style.backgroundColor="#dc3545"})),u.onclick=()=>this.clearSelectedIssues(),r.appendChild(u),t.appendChild(r);const m=document.createElement("div");m.id="comment-status",m.style.fontSize="12px",m.style.marginTop="5px",m.style.fontStyle="italic",t.appendChild(m);const p=document.createElement("div");p.id="comment-progress-container",p.style.display="none",p.style.marginTop="10px";const h=document.createElement("div");h.id="comment-progress-label",h.textContent="Submitting comments...",h.style.fontSize="12px",h.style.marginBottom="5px",p.appendChild(h);const y=document.createElement("div");y.style.height="10px",y.style.backgroundColor="#e9ecef",y.style.borderRadius="5px",y.style.overflow="hidden";const g=document.createElement("div");g.id="comment-progress-bar",g.style.height="100%",g.style.width="0%",g.style.backgroundColor="#1f75cb",g.style.transition="width 0.3s ease",y.appendChild(g),p.appendChild(y),t.appendChild(p),this.addCustomShortcuts(),e.appendChild(t)}addCustomShortcuts(){this.commentShortcuts&&this.commentShortcuts.addCustomShortcut({type:"label",label:"/label",items:[{value:"",label:"Add Label"},{value:"bug",label:"Bug"},{value:"feature",label:"Feature"},{value:"documentation",label:"Documentation"},{value:"enhancement",label:"Enhancement"},{value:"security",label:"Security"}],onSelect:e=>{const t=document.getElementById("issue-comment-input");if(!t)return;const s=`/label ~${e}`,n=t.selectionStart,o=t.selectionEnd,l=t.value;let i=s;n>0&&"\n"!==l.charAt(n-1)&&l.length>0&&(i="\n"+i);const a=l.substring(0,n)+i+l.substring(o);t.value=a,t.focus();const r=n+i.length;t.setSelectionRange(r,r)}})}clearSelectedIssues(){this.selectedIssues=[],this.updateSelectedIssuesDisplay();const e=document.getElementById("comment-status");e&&(e.textContent="Selection cleared.",e.style.color="#666")}async submitComments(){const e=document.getElementById("issue-comment-input"),t=document.getElementById("comment-status"),s=document.getElementById("comment-progress-container"),n=document.getElementById("comment-progress-bar"),o=document.getElementById("comment-progress-label");if(0===this.selectedIssues.length)return t.textContent="Error: No issues selected.",void(t.style.color="#dc3545");const l=e.value.trim();if(!l)return t.textContent="Error: Comment cannot be empty.",void(t.style.color="#dc3545");t.textContent=`Submitting comments to ${this.selectedIssues.length} issues...`,t.style.color="#1f75cb",s.style.display="block",n.style.width="0%";const i=document.querySelector("button");i&&i.textContent.includes("Add Comment")&&(i.disabled=!0,i.style.opacity="0.7",i.style.cursor="not-allowed");let a=0,r=0;for(let e=0;e<this.selectedIssues.length;e++){const t=this.selectedIssues[e],s=Math.round(e/this.selectedIssues.length*100);n.style.width=`${s}%`,o.textContent=`Processing ${e+1} of ${this.selectedIssues.length} issues...`;try{await gitlabApi.addComment(t,l),a++}catch(e){console.error(`Failed to add comment to issue #${t.iid}:`,e),r++}}n.style.width="100%",i&&i.textContent.includes("Add Comment")&&(i.disabled=!1,i.style.opacity="1",i.style.cursor="pointer"),a===this.selectedIssues.length?(t.textContent=`Successfully added comment to all ${a} issues!`,t.style.color="green",e.value="",this.showSuccessNotification(a),setTimeout((()=>{s.style.display="none"}),2e3),setTimeout((()=>{this.clearSelectedIssues(),t.textContent=""}),3e3)):(t.textContent=`Added comment to ${a} issues, failed for ${r} issues.`,t.style.color=a>0?"#ff9900":"#dc3545",n.style.backgroundColor=a>0?"#ff9900":"#dc3545")}setSelectedIssues(e){this.selectedIssues=e||[],this.updateSelectedIssuesDisplay();const t=document.getElementById("comment-status");if(t){const e=this.selectedIssues.length;t.textContent=`${e} issue${1!==e?"s":""} selected. Enter your comment and click "Add Comment".`,t.style.color="green"}}updateSelectedIssuesDisplay(){const e=document.getElementById("selected-issues-list");document.getElementById("no-issues-selected");if(!e)return;if(e.innerHTML="",0===this.selectedIssues.length){const t=document.createElement("div");t.id="no-issues-selected",t.textContent="No issues selected",t.style.color="#666",t.style.fontStyle="italic",e.appendChild(t);const s=e.parentElement;return void(s&&(s.style.borderColor="#ccc",s.style.backgroundColor="#f9f9f9"))}const t=e.parentElement;t&&(t.style.borderColor="#1f75cb",t.style.backgroundColor="rgba(31, 117, 203, 0.05)"),this.selectedIssues.forEach(((t,s)=>{const n=document.createElement("div");n.className="selected-issue-item",n.style.padding="5px",n.style.marginBottom="3px",n.style.borderRadius="3px",n.style.backgroundColor="rgba(31, 117, 203, 0.1)",n.style.display="flex",n.style.justifyContent="space-between",n.style.alignItems="center";const o=document.createElement("div");o.innerHTML=`<strong>#${t.iid}</strong> - ${t.title}`,o.style.overflow="hidden",o.style.textOverflow="ellipsis",o.style.whiteSpace="nowrap",o.style.marginRight="5px",n.appendChild(o);const l=document.createElement("button");l.textContent="Ã—",l.style.backgroundColor="transparent",l.style.border="none",l.style.color="#dc3545",l.style.fontSize="16px",l.style.fontWeight="bold",l.style.cursor="pointer",l.style.padding="0 5px",l.title="Remove this issue",l.addEventListener("mouseenter",(()=>{l.style.color="#c82333"})),l.addEventListener("mouseleave",(()=>{l.style.color="#dc3545"})),l.onclick=e=>{e.stopPropagation(),this.selectedIssues.splice(s,1),this.updateSelectedIssuesDisplay();const t=document.getElementById("comment-status");if(t){const e=this.selectedIssues.length;e>0?(t.textContent=`${e} issue${1!==e?"s":""} selected.`,t.style.color="green"):(t.textContent='No issues selected. Click "Select Issues" to choose issues.',t.style.color="#666")}},n.appendChild(l),e.appendChild(n)}))}setSelectedIssue(e){this.setSelectedIssues(e?[e]:[])}showSuccessNotification(e=1){const t=document.createElement("div");t.textContent=1===e?"Comment added successfully!":`Comments added to ${e} issues successfully!`,t.style.position="fixed",t.style.bottom="20px",t.style.right="20px",t.style.backgroundColor="#28a745",t.style.color="white",t.style.padding="10px 20px",t.style.borderRadius="4px",t.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.2)",t.style.zIndex="1001",t.style.opacity="0",t.style.transform="translateY(20px)",t.style.transition="opacity 0.3s ease, transform 0.3s ease",document.body.appendChild(t),setTimeout((()=>{t.style.opacity="1",t.style.transform="translateY(0)"}),10),setTimeout((()=>{t.style.opacity="0",t.style.transform="translateY(20px)",setTimeout((()=>{t.remove()}),300)}),3e3)}}function createSummaryContainer(){return uiManager.initialize(),uiManager.container}function renderHistory(){uiManager.historyView.render()}e.uiManager=e.uiManager||new class UIManager{constructor(){this.container=null,this.contentWrapper=null,this.statusDiv=null,this.header=null,this.headerDiv=null,this.recalculateBtn=null,this.collapseBtn=null,this.tabManager=new TabManager(this),this.summaryView=new SummaryTabView(this),this.boardsView=new BoardsTabView(this),this.historyView=new HistoryTabView(this),this.apiView=new ApiTabView(this),this.issueSelector=new IssueSelector(this)}initialize(){document.getElementById("assignee-time-summary")?this.container=document.getElementById("assignee-time-summary"):(this.container=document.createElement("div"),this.container.id="assignee-time-summary",this.container.style.position="fixed",this.container.style.bottom="15px",this.container.style.right="15px",this.container.style.backgroundColor="white",this.container.style.border="1px solid #ddd",this.container.style.borderRadius="4px",this.container.style.padding="10px",this.container.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",this.container.style.zIndex="1000",this.container.style.maxHeight="80vh",this.container.style.overflow="hidden",this.container.style.fontSize="14px",this.container.style.width="300px",this.container.style.transition="height 0.3s ease-in-out",this.contentWrapper=document.createElement("div"),this.contentWrapper.id="assignee-time-summary-wrapper",this.contentWrapper.style.display="block",this.contentWrapper.style.maxHeight="70vh",this.contentWrapper.style.overflowY="auto",this.createHeader(),this.statusDiv=document.createElement("div"),this.statusDiv.id="assignee-time-summary-status",this.statusDiv.style.fontSize="12px",this.statusDiv.style.color="#666",this.statusDiv.style.marginBottom="10px",this.statusDiv.style.marginTop="10px",this.statusDiv.textContent="Initializing...",this.contentWrapper.appendChild(this.statusDiv),this.tabManager.initialize(this.contentWrapper),this.container.appendChild(this.contentWrapper),document.body.appendChild(this.container),"true"===localStorage.getItem("gitlabTimeSummaryCollapsed")&&(this.contentWrapper.style.display="none",this.collapseBtn.textContent="â–²",this.container.style.height="auto"))}createHeader(){this.headerDiv=document.createElement("div"),this.headerDiv.style.display="flex",this.headerDiv.style.justifyContent="space-between",this.headerDiv.style.alignItems="center",this.headerDiv.style.marginBottom="0px",this.headerDiv.style.cursor="pointer",this.headerDiv.addEventListener("click",(e=>{e.target!==this.recalculateBtn&&e.target!==this.collapseBtn&&this.toggleCollapse()})),this.header=document.createElement("h3"),this.header.id="assignee-time-summary-header",this.header.textContent="Summary",this.header.style.margin="0",this.header.style.fontSize="16px";const e=document.createElement("div");e.style.display="flex",e.style.gap="5px",this.recalculateBtn=document.createElement("button"),this.recalculateBtn.textContent="ðŸ”„",this.recalculateBtn.title="Recalculate",this.recalculateBtn.style.padding="3px 6px",this.recalculateBtn.style.fontSize="12px",this.recalculateBtn.style.backgroundColor="#1f75cb",this.recalculateBtn.style.color="white",this.recalculateBtn.style.border="none",this.recalculateBtn.style.borderRadius="3px",this.recalculateBtn.style.cursor="pointer",this.recalculateBtn.onclick=e=>{e.stopPropagation(),updateSummary(!0),this.recalculateBtn.textContent="âœ“",setTimeout((()=>{this.recalculateBtn.textContent="ðŸ”„"}),1e3)},this.collapseBtn=document.createElement("button"),this.collapseBtn.textContent="â–¼",this.collapseBtn.title="Collapse/Expand",this.collapseBtn.style.padding="3px 6px",this.collapseBtn.style.fontSize="12px",this.collapseBtn.style.backgroundColor="#777",this.collapseBtn.style.color="white",this.collapseBtn.style.border="none",this.collapseBtn.style.borderRadius="3px",this.collapseBtn.style.cursor="pointer",this.collapseBtn.onclick=e=>{e.stopPropagation(),this.toggleCollapse()},e.appendChild(this.recalculateBtn),e.appendChild(this.collapseBtn),this.headerDiv.appendChild(this.header),this.headerDiv.appendChild(e),this.container.appendChild(this.headerDiv)}toggleCollapse(){"none"===this.contentWrapper.style.display?(this.contentWrapper.style.display="block",this.collapseBtn.textContent="â–¼",this.container.style.height="",localStorage.setItem("gitlabTimeSummaryCollapsed","false")):(this.contentWrapper.style.display="none",this.collapseBtn.textContent="â–²",this.container.style.height="auto",localStorage.setItem("gitlabTimeSummaryCollapsed","true"))}updateStatus(e){this.statusDiv&&(this.statusDiv.textContent=e)}updateHeader(e){this.header&&(this.header.textContent=e)}},e.addEventListener("scroll",(()=>{uiManager&&uiManager.issueSelector&&"function"==typeof uiManager.issueSelector.repositionOverlays&&uiManager.issueSelector.repositionOverlays()})),e.addEventListener("resize",(()=>{uiManager&&uiManager.issueSelector&&"function"==typeof uiManager.issueSelector.repositionOverlays&&uiManager.issueSelector.repositionOverlays()})),e.uiManager=uiManager,function(){"use strict";let t,s=!1;function updateSummary(n=!1){s=!1,clearTimeout(t);const o=document.getElementById("assignee-time-summary-status");o&&(o.textContent="Analyzing board...");const{assigneeTimeMap:l,boardData:i,boardAssigneeData:a,totalEstimate:r,cardsProcessed:d,cardsWithTime:c,currentMilestone:u}=function processBoards(){const e={},t={},s={};let n=0,o=0,l=0,i=null;return document.querySelectorAll(".board-list").forEach(((a,r)=>{let d="Unknown";try{if(a.__vue__&&a.__vue__.$children&&a.__vue__.$children.length>0){const e=a.__vue__.$children.find((e=>e.$props&&e.$props.list&&e.$props.list.title));e&&e.$props.list.title&&(d=e.$props.list.title)}if("Unknown"===d){const e=a.querySelector(".board-title-text");e&&(d=e.textContent.trim())}}catch(e){console.error("Error getting board title:",e);const t=a.querySelector(".board-title-text");t&&(d=t.textContent.trim())}"Unknown"!==d&&(t[d]||(t[d]={tickets:0,timeEstimate:0}),s[d]||(s[d]={}),a.querySelectorAll(".board-card").forEach((a=>{try{if(o++,t[d].tickets++,a.__vue__&&a.__vue__.$children){const o=a.__vue__.$children.find((e=>e.$props&&e.$props.item&&void 0!==e.$props.item.timeEstimate));if(o&&o.$props){const a=o.$props;if(!i&&a.item&&a.item.milestone&&(i=a.item.milestone.title),a.item&&a.item.timeEstimate){l++;const o=a.item.timeEstimate;n+=o,t[d].timeEstimate+=o;let i=[];a.item.assignees&&a.item.assignees.nodes&&a.item.assignees.nodes.length?i=a.item.assignees.nodes:a.item.assignees&&a.item.assignees.length>0&&(i=a.item.assignees),i.length>0?i.forEach((t=>{const n=o/i.length,l=t.name;e[l]||(e[l]=0),e[l]+=n,s[d][l]||(s[d][l]={tickets:0,timeEstimate:0}),s[d][l].tickets++,s[d][l].timeEstimate+=n})):(e.Unassigned||(e.Unassigned=0),e.Unassigned+=o,s[d].Unassigned||(s[d].Unassigned={tickets:0,timeEstimate:0}),s[d].Unassigned.tickets++,s[d].Unassigned.timeEstimate+=o)}}}}catch(e){console.error("Error processing card:",e)}})))})),{assigneeTimeMap:e,boardData:t,boardAssigneeData:s,totalEstimate:n,cardsProcessed:o,cardsWithTime:l,currentMilestone:i}}();clearTimeout(t),t=setTimeout((()=>{s=!0,s&&function saveHistoryEntry(t,s,n=!1){try{const n=new Date,o=n.toISOString(),l=(t/3600).toFixed(1),i=getHistoryKey();let a="None";s&&(a=s.replace(/\n/g," ").trim());let r=GM_getValue(i,[]);const d={date:o,timestamp:n.getTime(),totalHours:l,milestone:a,url:e.location.href};let c=!1;if(0===r.length)c=!0;else{const e=r[r.length-1];e.totalHours===d.totalHours&&e.milestone===d.milestone||(c=!0)}c&&(r.push(d),r.length>100&&(r=r.slice(-100)),GM_setValue(i,r),"block"===document.getElementById("history-time-summary-content").style.display&&renderHistory())}catch(e){console.error("Error saving history:",e)}}(r,u,n)}),3e3),function updateSummaryTab(e,t,s,n,o){uiManager.summaryView.render(e,t,s,n,o)}(l,r,d,c,u),function updateBoardsTab(e,t){uiManager.boardsView.render(e,t)}(i,a);const m=document.getElementById("api-info-content");m&&"block"===m.style.display&&function updateApiInfoTab(){uiManager.apiView.render()}()}function addBoardChangeListeners(){document.querySelectorAll(".board-list").forEach((e=>{new MutationObserver((()=>{updateSummary()})).observe(e,{childList:!0,subtree:!0})}))}function checkAndInit(){e.location.href.includes("/boards")&&(document.getElementById("assignee-time-summary")||createSummaryContainer(),function waitForBoards(){const e=document.getElementById("assignee-time-summary-status");e&&(e.textContent="Waiting for boards to load...");let t=0;const s=setInterval((()=>{t++;const n=document.querySelectorAll(".board-list");n.length>=5||t>=30?(clearInterval(s),e&&(e.textContent=`Found ${n.length} boards, initializing...`),setTimeout((()=>{updateSummary(),addBoardChangeListeners()}),1e3)):n.length>0&&e&&(e.textContent=`Found ${n.length} of 5 boards...`)}),500)}())}checkAndInit();let n=e.location.href;new MutationObserver((()=>{e.location.href!==n&&(n=e.location.href,setTimeout(checkAndInit,1e3))})).observe(document,{subtree:!0,childList:!0}),e.gitlabHelper={updateSummary:updateSummary,gitlabApi:gitlabApi,uiManager:uiManager}}()}(window);